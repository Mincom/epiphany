---
# Common Debian family specific tasks

- name: Disable timers for unattended upgrade, so that none will be triggered by the `date -s` call.
  raw: systemctl disable --now {{item}}
  with_items:
    - 'apt-daily.timer'
    - 'apt-daily-upgrade.timer'

- name: Reload systemctl daemon to apply the new changes
  raw: systemctl daemon-reload

- name: Purge unattended upgrades
  raw: apt-get -y purge unattended-upgrades
  register: task_status_out
  retries: 60
  delay: 10
  until: 'task_status_out.rc == 0'

- name: Install selinux packages as prerequisite for SELinux module
  apt:
    name:
      - build-essential
      - python-selinux
    update_cache: yes
    state: present

- name: Install Debian family packages
  apt:
    name:
      - apt-transport-https
      - bash-completion
      - ca-certificates
      - curl
      - ebtables
      - ethtool
      - fping
      - htop
      - iftop
      - jq
      - logrotate
      - net-tools
      - netcat
      - openssl
      - python-setuptools
      - software-properties-common
      - sshpass
      - sysstat
      - tar
      - telnet
      - tmux
      - unzip
      - vim
    update_cache: yes
    state: present

- name: Append prompt to .profile
  lineinfile:
    path: /home/{{ admin_user.name }}/.profile
    line: source /etc/profile.d/operations.sh
